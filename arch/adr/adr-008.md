# ADR 8: 发送事件支持直接发和数据库事件表两种方式

Date: 2020-01-07

## 状态

生效中

## 背景

为了提高系统的可测试性与一致性，最初选择了通过数据库事件表发送event，即在业务模块生成事件时先写入数据库的events表中，使用业务无关的模块producer将events表中的事件发到消息队列。

使用事件表模式的优点在于测试简单，想要保证事务性也更容易。但缺点在于想要提高producer吞吐率时，会比较复杂。

如果直接发送事件到消息队列，比较容易通过横向扩展提高事件发送吞吐率。缺点是在没有高质量配套设施的时候，测试比较困难。

## 决定

将事件发送相关代码提取出来，与业务代码隔离。

开发模式下，默认发送到数据库事件表，保留可测试性。

上线运行时，可通过配置直接把事件发送到消息队列，提高吞吐率。

由于基础设施模块不含业务，完成之后几乎不会修改，所以可以通过UAT环境测试保证初版的质量。
后续不会修改相关代码也就不会引入缺陷。

## 后果

兼顾了事件发送的可测试性与吞吐率。
